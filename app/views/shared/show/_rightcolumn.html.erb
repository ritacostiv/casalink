  <!-- app/views/shared/show/_rightcolumn.html -->

<div class="right column"
     style="flex: 1; background-color: rgb(227, 223, 223); border-radius: 12px; min-height: 600px; position: relative;">

  <!-- The actual map element -->
  <div id="map" style="width: 100%; height: 100%; border-radius: 12px;"></div>

  <script>
    document.addEventListener('turbo:load', () => {
      // 1) Initialize the map on #map
      const map = L.map('map').setView([38.7223, -9.1393], 12); // Lisbon-ish coords

      // 2) Load map tiles (OpenStreetMap)
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '© OpenStreetMap contributors'
      }).addTo(map);

      // 3) Convert Ruby data to JS
      const properties = <%= raw @properties.to_json(only: [:name, :latitude, :longitude]) %>;

      // 4) Create a group for markers
      const markersGroup = L.featureGroup();

      // 5) Add markers for each property
      properties.forEach(property => {
        if (property.latitude && property.longitude) {
          const marker = L.marker([property.latitude, property.longitude]);
          marker.bindPopup(`<strong>${property.name}</strong>`);
          markersGroup.addLayer(marker);
        }
      });

      markersGroup.addTo(map);

      // 6) Auto-fit if we have markers
      if (markersGroup.getLayers().length > 0) {
        map.fitBounds(markersGroup.getBounds(), { padding: [50, 50] });
      }
    });
  </script>

  <!-- Map controls (optional placeholders) -->
  <div style="position: absolute; top: 20px; right: 20px; display: flex; flex-direction: column; gap: 10px;">
    <button style="width: 40px; height: 40px; background-color: white; border-radius: 50%; border: none;
                   box-shadow: 0 2px 5px rgba(0,0,0,0.2); display: flex; align-items: center; justify-content: center;">+
    </button>
    <button style="width: 40px; height: 40px; background-color: white; border-radius: 50%; border: none;
                   box-shadow: 0 2px 5px rgba(0,0,0,0.2); display: flex; align-items: center; justify-content: center;">−
    </button>
  </div>

  <div style="position: absolute; bottom: 20px; right: 20px;">
    <button style="width: 40px; height: 40px; background-color: white; border-radius: 50%; border: none;
                   box-shadow: 0 2px 5px rgba(0,0,0,0.2); display: flex; align-items: center; justify-content: center;">✋
    </button>
  </div>
</div>
